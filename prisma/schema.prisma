generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Department {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now())
  roles     Role[]
  users     User[]
}

model Role {
  id           String     @id @default(uuid())
  name         String
  departmentId String
  department   Department @relation(fields: [departmentId], references: [id])
  users        User[]
}

model User {
  id           String     @id @default(uuid())
  name         String
  email        String     @unique
  roleId       String?
  role         Role?      @relation(fields: [roleId], references: [id])
  departmentId String?
  department   Department? @relation(fields: [departmentId], references: [id])
  
  // Hierarquia
  managerId    String?
  manager      User?      @relation("ManagerToSubordinate", fields: [managerId], references: [id])
  subordinates User[]     @relation("ManagerToSubordinate")
  
  myDeputyId   String?    @unique
  myDeputy     User?      @relation("DeputyRelation", fields: [myDeputyId], references: [id])
  deputyOf     User?      @relation("DeputyRelation")

  // Ferramentas que ele Ã© dono
  toolsOwned   Tool[]     @relation("ToolOwner")
  toolsSubOwned Tool[]    @relation("ToolSubOwner")

  // Acessos que ele tem (NOVO! ðŸ‘‡)
  accesses     Access[]

  // SolicitaÃ§Ãµes
  requests     Request[]
}

model Tool {
  id          String   @id @default(uuid())
  name        String
  
  ownerId     String?
  owner       User?    @relation("ToolOwner", fields: [ownerId], references: [id])
  
  subOwnerId  String?
  subOwner    User?    @relation("ToolSubOwner", fields: [subOwnerId], references: [id])

  // Quem tem acesso a essa ferramenta (NOVO! ðŸ‘‡)
  accesses    Access[]

  createdAt   DateTime @default(now())
}

// --- TABELA NOVA (Copie tudo isso) ---
model Access {
  id        String   @id @default(uuid())
  status    String   @default("ACTIVE") // ACTIVE, REVOKED, PENDING
  
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  toolId    String
  tool      Tool     @relation(fields: [toolId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
}
// -------------------------------------

model Request {
  id              String   @id @default(uuid())
  requesterId     String
  requester       User     @relation(fields: [requesterId], references: [id])
  
  type            String
  status          String   @default("PENDENTE_GESTOR")
  
  // ADICIONE ESTA LINHA ðŸ‘‡
  currentApproverRole String? // Ex: 'MANAGER', 'SI_ANALYST', 'HEAD'
  
  details         String   // JSON string
  justification   String?
  isExtraordinary Boolean  @default(false)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}